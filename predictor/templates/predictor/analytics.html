{% extends 'predictor/base.html' %}

{% block title %}Analytics Dashboard - Gold Price Predictor{% endblock %}

{% block extra_css %}
<style>
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        color: white;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .metric-label {
        font-size: 0.9em;
        opacity: 0.9;
        margin-bottom: 12px;
    }

    .metric-value {
        font-size: 2.2em;
        font-weight: bold;
    }

    .chart-container {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .chart-container h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.4em;
        font-weight: 600;
    }

    .data-sources {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        border-left: 4px solid #667eea;
    }

    .data-sources h4 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.2em;
    }

    .source-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        color: #5a6c7d;
        border-bottom: 1px solid #e0e0e0;
    }

    .source-item:last-child {
        border-bottom: none;
    }

    @media (max-width: 1024px) {
        .metrics-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .metrics-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr; gap: 30px;">
    <div class="card">
        <h2>Model Performance Metrics</h2>
        
        <div class="metrics-grid">
            <div class="metric-box">
                <div class="metric-label">R¬≤ Score</div>
                <div class="metric-value" id="r2Score">0.9996</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">RMSE</div>
                <div class="metric-value" id="rmseScore">384.89</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">MAE</div>
                <div class="metric-value" id="maeScore">476.01</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="chart-container">
            <h3>‚öñÔ∏è Feature Importance</h3>
            <canvas id="featureImportanceChart" height="300"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="chart-container">
            <h3>üìä Model Performance Comparison</h3>
            <canvas id="modelComparisonChart" height="350"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="data-sources">
            <h4>üåê Live Data Sources</h4>
            <div class="source-item">
                <span>Gold Price:</span>
                <span>GoldAPI & MetalPriceAPI</span>
            </div>
            <div class="source-item">
                <span>Exchange Rate:</span>
                <span>Open Exchange Rates</span>
            </div>
            <div class="source-item">
                <span>Economic Data:</span>
                <span>World Bank & IMF</span>
            </div>
            <div class="source-item">
                <span>Stock Market:</span>
                <span>NEPSE Official</span>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    let featureImportanceChart = null;
    let modelComparisonChart = null;

    document.addEventListener('DOMContentLoaded', function() {
        initializeAnalyticsCharts();
    });

    function initializeAnalyticsCharts() {
        // Feature Importance Chart
        const featureCtx = document.getElementById('featureImportanceChart').getContext('2d');
        featureImportanceChart = new Chart(featureCtx, {
            type: 'bar',
            data: {
                labels: ['USD Rate', 'Gold Price USD', 'Inflation Rate', 'Interest Rate', 'NEPSE Index', 'Festivals'],
                datasets: [{
                    label: 'Impact Weight',
                    data: [0.35, 0.25, 0.15, 0.12, 0.08, 0.05],
                    backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#43e97b'],
                    borderColor: ['#556cd6', '#654ba2', '#e083eb', '#e5475c', '#3c9cfe', '#33d97b'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, max: 0.4 }
                }
            }
        });

        // Model Comparison Chart
        const modelCtx = document.getElementById('modelComparisonChart').getContext('2d');
        modelComparisonChart = new Chart(modelCtx, {
            type: 'radar',
            data: {
                labels: ['R¬≤ Score', 'RMSE', 'MAE', 'Speed', 'Accuracy', 'Stability'],
                datasets: [
                    {
                        label: 'Linear Regression',
                        data: [0.95, 0.9, 0.85, 1.0, 0.95, 0.9],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        pointBackgroundColor: '#667eea'
                    },
                    {
                        label: 'Gradient Boosting',
                        data: [0.85, 0.8, 0.75, 0.6, 0.8, 0.85],
                        borderColor: '#FF9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.2)',
                        pointBackgroundColor: '#FF9800'
                    },
                    {
                        label: 'Random Forest',
                        data: [0.8, 0.7, 0.65, 0.4, 0.75, 0.8],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        pointBackgroundColor: '#4CAF50'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: { beginAtZero: true, max: 1, ticks: { stepSize: 0.2 } }
                }
            }
        });
    }
</script>
{% endblock %}
